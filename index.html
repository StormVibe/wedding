<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Wedding Invitation">
  <title>Wedding Invitation - Divna & Nick</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

<nav>
  <ul>
    <li><a href="https://divna-nick.org/">Home</a></li>
    <li><a href="https://divna-nick.org/#wedding-details">Wedding Ceremony</a></li>
    <li><a href="https://divna-nick.org/#reception-details">Reception</a></li>
    <li><a href="https://divna-nick.org/photos">Pictures</a></li>
    <li><a href="https://divna-nick.org/wedding">Orthodox Wedding</a></li>
    <li><a href="https://divna-nick.org/#rsvp">RSVP</a></li>
  </ul>
</nav>

<header>
  <h1>Wedding Invitation</h1>
  <p>We are so excited to share this special day with you!</p>

  <section id="couple-intro">
    <button onclick="document.getElementById('rsvp').scrollIntoView({behavior:'smooth'})">
      RSVP Now
    </button>
    <h2>Meet the Couple</h2>
    <div id="couple-photo">
      <img src="couple-photo.jpg" alt="Divna & Nick">
    </div>
    <p><strong>Divna & Nick</strong> invite you to celebrate their wedding!</p>
  </section>
</header>

<section id="wedding-details">
  <h2>The Wedding Ceremony</h2>
  <p><strong>Date:</strong> Sunday, April 19, 2026 at 3:00 PM</p><br>
  <p><strong>Location:</strong> 2219 Summit St Columbus, Ohio</p>
  <div class="directions">
	<a href="https://www.google.com/maps/place/?q=place_id:ChIJF3ld-66OOIgRk9w2QbjoCXI" target="_blank">
    Get Directions
	</a>
  </div>
</section>

<section id="reception-details">
  <h2>The Reception</h2>
  <p><strong>Date:</strong> Sunday, April 19, 2026 at 5:00 PM to 8:30 PM</p><br><br>
  <p><strong>Location:</strong> TBD <br><br>
    <a href="#rsvp">RSVP</a> or <a href="mailto:rsvp@divna-nick.org">contact us</a> for updates!</p>
</section>

<section id="rsvp">
  <h2>RSVP</h2>

  <form id="rsvp-form">
    <label>Email</label>
    <input type="email" name="entry.12345678" required>

    <label>Name</label>
    <input type="text" name="entry.23456789" required>

    <label>Number of Guests</label>
    <input type="number" name="entry.34567890" min="0" required>

    <label>Invite Code</label>
    <input type="text" name="entry.45678901" required>

    <button type="submit">Submit RSVP</button>
  </form>

  <div id="rsvp-message"></div>
</section>

<!-- Calendar Modal -->
<div id="calendar-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>RSVP confirmed! Add this event to your calendar?</h3>
    <div class="calendar-buttons">
      <button id="download-ics">Download ICS</button>
      <button id="open-google">Open Google Calendar</button>
      <button id="calendar-no">No Thanks</button>
    </div>
  </div>
</div>

<footer>
  <p>&copy; 2026 Divna & Nick</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const APP_SCRIPT_URL =
    'https://script.google.com/macros/s/AKfycbyx8zY4M01WMRWbDoKuewx0K0Rkn4UeVaWa7TYnvuZfJtPacN321NZGfpDovHOcfq1r/exec';

  /* ========= JWT ========= */

  async function fetchJWT(inviteCode) {
    const url =
      `${APP_SCRIPT_URL}?action=jwt&invite=${encodeURIComponent(inviteCode)}`;

    const res = await fetch(url);
    const data = await res.json();

    if (!data.token) {
      throw new Error(data.error || 'JWT issuance failed');
    }

    return data.token;
  }

  /* ========= MODAL ========= */

  const modal = document.getElementById('calendar-modal');

  function showCalendarModal() {
    modal.style.display = 'flex';
  }

  function closeCalendarModal() {
    modal.style.display = 'none';
  }

  /* ========= CALENDAR ========= */

  function downloadCalendarICS() {
    const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Wedding Invitation//EN
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:wedding-${Date.now()}@example.com
DTSTAMP:${new Date().toISOString().replace(/[-:]/g,'').split('.')[0]}Z
DTSTART:20260419T153000
DTEND:20260419T090000
SUMMARY:Divna & Nick's Wedding
DESCRIPTION:We can't wait to celebrate with you!
LOCATION:2219 Summit St Columbus, Ohio
END:VEVENT
END:VCALENDAR`;

    const blob = new Blob([ics.replace(/\n/g, '\r\n')], {
      type: 'text/calendar;charset=utf-8'
    });

    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'Wedding.ics';
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function openGoogleCalendar() {
    const url =
      'https://www.google.com/calendar/render?action=TEMPLATE' +
      '&text=' + encodeURIComponent("Divna & Nick's Wedding") +
      '&dates=20260419T153000/20260419T210000' +
      '&details=' + encodeURIComponent("We can't wait to celebrate with you!") +
      '&location=' + encodeURIComponent("2219 Summit St Columbus, Ohio");

    window.open(url, '_blank');
  }

  /* ========= RSVP ========= */

  document.getElementById('rsvp-form')
    .addEventListener('submit', async e => {
      e.preventDefault();

      const msg = document.getElementById('rsvp-message');
      msg.textContent = 'Securing your invitation...';

      try {
        const formData = new FormData(e.target);
        const invite = formData.get('entry.45678901');

        const jwt = await fetchJWT(invite);
        formData.append('jwt', jwt);

        msg.textContent = 'Saving your RSVP...';

        const res = await fetch(APP_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const data = await res.json();

        if (data.result === 'success') {
          msg.textContent = 'RSVP submitted successfully! Check your email in 5 minutes (might show up in spam)';
          e.target.reset();
          showCalendarModal();
        } else {
          msg.textContent = 'Error: ' + data.message;
        }

      } catch (err) {
        msg.textContent = err.message || 'Server error';
      }
    });

  document.getElementById('download-ics').onclick = () => {
    downloadCalendarICS();
    closeCalendarModal();
  };

  document.getElementById('open-google').onclick = () => {
    openGoogleCalendar();
    closeCalendarModal();
  };

  document.getElementById('calendar-no').onclick = closeCalendarModal;

});
</script>

</body>
</html>
